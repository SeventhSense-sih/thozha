<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Verification Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-storage.js"></script>
</head>
<body>
<h1>Admin Verification Dashboard</h1>
<div id="login-form">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>
<div id="admin-dashboard" style="display:none;">
    <h2>Pending Verifications</h2>
    <div id="verification-requests"></div>
</div>

<script>
    // Firebase initialization
    const firebaseConfig = {
        apiKey: "AIzaSyBPakaUy-eaQA7K_qMcSqJISkZotccOG5g",
        authDomain: "thozha-9574a.firebaseapp.com",
        projectId: "thozha-9574a",
        storageBucket: "thozha-9574a.appspot.com",
        messagingSenderId: "674224858702",
        appId: "1:674224858702:web:d1914bd91067f05a9a851f",
        measurementId: "G-P2EEG49S72"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Admin login logic
    function login() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, password)
            .then(userCredential => {
                // Check if the logged-in user is an admin
                const userId = userCredential.user.uid;
                db.collection('admins').doc(userId).get().then(doc => {
                    if (doc.exists) {
                        document.getElementById('login-form').style.display = 'none';
                        document.getElementById('admin-dashboard').style.display = 'block';
                        fetchPendingVerifications();
                    } else {
                        alert('You are not authorized to access this page.');
                        auth.signOut();
                    }
                });
            })
            .catch(error => {
                alert('Login failed: ' + error.message);
            });
    }

    // Fetch and display verification requests
    function fetchPendingVerifications() {
        db.collection('verifications').where('status', '==', 'pending').get().then(snapshot => {
            const container = document.getElementById('verification-requests');
            container.innerHTML = ''; // Clear previous data
            snapshot.docs.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.innerHTML = `
                    <p>User ID: ${data.userId}</p>
                    <p>Status: ${data.status}</p>
                    <img src="${data.idProofUrl}" width="200" />
                    <button onclick="approve('${doc.id}')">Approve</button>
                    <button onclick="reject('${doc.id}')">Reject</button>
                `;
                container.appendChild(div);
            });
        });
    }

    // Approve verification
    function approve(docId) {
        db.collection('verifications').doc(docId).update({ status: 'verified' });
        db.collection('users').doc(docId).update({ isVerified: true, verificationStatus: 'verified' });
        alert('User verified successfully.');
        fetchPendingVerifications();
    }

    // Reject verification
    function reject(docId) {
        db.collection('verifications').doc(docId).update({ status: 'rejected' });
        alert('User verification rejected.');
        fetchPendingVerifications();
    }

    // Make a normal user an admin (use this once per user to add to admin list)
    function makeUserAdmin(userId) {
        db.collection('admins').doc(userId).set({ role: 'admin' })
            .then(() => alert('User made admin successfully.'));
    }
</script>
</body>
</html>
